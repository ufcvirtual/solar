lesson_cookie_id = "_ufc_solar20_lesson_opened";

function maximize_lesson(obj) {
  var home_tab = $(".mysolar_unit_active_tab.general_context").length;
  if (!$.cookie(lesson_cookie_id) || home_tab)
    return;

  $(obj).nice_open_lesson({ href: $.cookie(lesson_cookie_id) });
  event.preventDefault();
}

function minimize_lesson() {
  var home_tab = $(".mysolar_unit_active_tab.general_context").length;
  if (!home_tab) {
    // save cookie with the new url
    var lesson_URL = $(".fancybox-iframe").contents().find(".lesson .content").data("url");
    $.cookie(lesson_cookie_id, lesson_URL);

    $(".fancybox-skin").effect( "transfer", { to: $("#mysolar_open_lesson") }, 750 ); // transfer effect
    $("#mysolar_open_lesson button").removeClass("disabled");
  }
  else
    $("#mysolar_open_lesson button").addClass("disabled");
  $.fancybox.close();
}

function close_lesson() {
  $("#mysolar_open_lesson button").addClass("disabled");
  $.removeCookie(lesson_cookie_id);
}

function open_new_lesson_on_fancybox(lesson_path, lesson_url) {
  $('.lesson .content').attr('data-url', lesson_url);
  $('.lesson .content iframe').attr('src', lesson_path);

  // update status da lesson
  var lesson_draft = $('.breadcrumb .lessons #lesson option:selected').data('draft');
  if (lesson_draft) {
    $('.lesson_status .draft').removeClass('invisible');
    $('.lesson_status .released').addClass('invisible');
  } else {
    $('.lesson_status .draft').addClass('invisible');
    $('.lesson_status .released').removeClass('invisible');
  }
}

$(function(){
  // select modules
  $("select#lesson_module").change(function(){
    var lessons_url = get_module_lessons_url.replace('lesson_module_id', $(this).val());
    $.get(lessons_url, function(data){
      $('.breadcrumb .lessons').html(data);

      var lesson_path = $('option:selected', data).data('path');
      var lesson_url = get_lesson_url.replace('lesson_id', $('.breadcrumb .lessons #lesson').val());

      open_new_lesson_on_fancybox(lesson_path, lesson_url);
    });
  });

  // select lessons
  $('.breadcrumb .lessons').on('change', '#lesson', function(){
    var lesson_path = $('#lesson option:selected').data('path');
    var lesson_url = get_lesson_url.replace('lesson_id', $(this).val());

    open_new_lesson_on_fancybox(lesson_path, lesson_url);
  });
});
