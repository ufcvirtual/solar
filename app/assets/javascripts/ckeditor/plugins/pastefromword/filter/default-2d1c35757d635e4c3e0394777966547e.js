/*
 Copyright (c) 2003-2014, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
(function(){function e(e){for(var e=e.toUpperCase(),t=u.length,n=0,r=0;r<t;++r)for(var i=u[r],s=i[1].length;e.substr(0,s)==i[1];e=e.substr(s))n+=i[0];return n}function t(e){for(var e=e.toUpperCase(),t=a.length,n=1,r=1;0<e.length;r*=t)n+=a.indexOf(e.charAt(e.length-1))*r,e=e.substr(0,e.length-1);return n}var n=CKEDITOR.htmlParser.fragment.prototype,r=CKEDITOR.htmlParser.element.prototype;n.onlyChild=r.onlyChild=function(){var e=this.children;return 1==e.length&&e[0]||null},r.removeAnyChildWithName=function(e){for(var t=this.children,n=[],r,i=0;i<t.length;i++)r=t[i],r.name&&(r.name==e&&(n.push(r),t.splice(i--,1)),n=n.concat(r.removeAnyChildWithName(e)));return n},r.getAncestor=function(e){for(var t=this.parent;t&&(!t.name||!t.name.match(e));)t=t.parent;return t},n.firstChild=r.firstChild=function(e){for(var t,n=0;n<this.children.length;n++)if(t=this.children[n],e(t)||t.name&&(t=t.firstChild(e)))return t;return null},r.addStyle=function(e,t,n){var r="";if("string"==typeof t)r+=e+":"+t+";";else{if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&(r+=i+":"+e[i]+";");else r+=e;n=t}this.attributes||(this.attributes={}),e=this.attributes.style||"",e=(n?[r,e]:[e,r]).join(";"),this.attributes.style=e.replace(/^;|;(?=;)/,"")},r.getStyle=function(e){var t=this.attributes.style;if(t)return t=CKEDITOR.tools.parseCssText(t,1),t[e]},CKEDITOR.dtd.parentOf=function(e){var t={},n;for(n in this)-1==n.indexOf("$")&&this[n][e]&&(t[n]=1);return t};var i=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,s=/^(?:\b0[^\s]*\s*){1,4}$/,o={ol:{decimal:/\d+/,"lower-roman":/^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$/,"upper-roman":/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,"lower-alpha":/^[a-z]+$/,"upper-alpha":/^[A-Z]+$/},ul:{disc:/[l\u00B7\u2002]/,circle:/[\u006F\u00D8]/,square:/[\u006E\u25C6]/}},u=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],a="ABCDEFGHIJKLMNOPQRSTUVWXYZ",f=0,l=null,c,h=CKEDITOR.plugins.pastefromword={utils:{createListBulletMarker:function(e,t){var n=new CKEDITOR.htmlParser.element("cke:listbullet");return n.attributes={"cke:listsymbol":e[0]},n.add(new CKEDITOR.htmlParser.text(t)),n},isListBulletIndicator:function(e){if(/mso-list\s*:\s*Ignore/i.test(e.attributes&&e.attributes.style))return!0},isContainingOnlySpaces:function(e){var t;return(t=e.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(t.value)},resolveList:function(e){var t=e.attributes,n;return(n=e.removeAnyChildWithName("cke:listbullet"))&&n.length&&(n=n[0])?(e.name="cke:li",t.style&&(t.style=h.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(e){e=e.split(" "),e=CKEDITOR.tools.convertToPx(e[3]||e[1]||e[0]),!f&&null!==l&&e>l&&(f=e-l),l=e,t["cke:indent"]=f&&Math.ceil(e/f)+1||1}],[/^mso-list$/,null,function(e){var e=e.split(" "),n=Number(e[0].match(/\d+/)),e=Number(e[1].match(/\d+/));1==e&&(n!==c&&(t["cke:reset"]=1),c=n),t["cke:indent"]=e}]])(t.style,e)||""),t["cke:indent"]||(l=0,t["cke:indent"]=1),CKEDITOR.tools.extend(t,n.attributes),!0):(c=l=f=null,!1)},getStyleComponents:function(){var e=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',CKEDITOR.document);return CKEDITOR.document.getBody().append(e),function(t,n,r){e.setStyle(t,n);for(var t={},n=r.length,i=0;i<n;i++)t[r[i]]=e.getStyle(r[i]);return t}}(),listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(e,t){var t="number"==typeof t?t:1,n=e.attributes,r;switch(n.type){case"a":r="lower-alpha";break;case"1":r="decimal"}for(var s=e.children,o,u=0;u<s.length;u++)if(o=s[u],o.name in CKEDITOR.dtd.$listItem){var a=o.attributes,f=o.children,p=f[f.length-1];p.name in CKEDITOR.dtd.$list&&(e.add(p,u+1),--f.length||s.splice(u--,1)),o.name="cke:li",n.start&&!u&&(a.value=n.start),h.filters.stylesFilter([["tab-stops",null,function(e){(e=e.split(" ")[1].match(i))&&(l=CKEDITOR.tools.convertToPx(e[0]))}],1==t?["mso-list",null,function(e){e=e.split(" "),e=Number(e[0].match(/\d+/)),e!==c&&(a["cke:reset"]=1),c=e}]:null])(a.style),a["cke:indent"]=t,a["cke:listtype"]=e.name,a["cke:list-style-type"]=r}else if(o.name in CKEDITOR.dtd.$list){arguments.callee.apply(this,[o,t+1]),s=s.slice(0,u).concat(o.children).concat(s.slice(u+1)),e.children=[],o=0;for(f=s.length;o<f;o++)e.add(s[o]);s=e.children}delete e.name,n["cke:list"]=1},assembleList:function(n){for(var r=n.children,i,s,u,a,h,p,n=[],d,v,m,g,b,E,S=0;S<r.length;S++)if(i=r[S],"cke:li"==i.name)if(i.name="li",s=i.attributes,m=(m=s["cke:listsymbol"])&&m.match(/^(?:[(]?)([^\s]+?)([.)]?)$/),g=b=E=null,s["cke:ignored"])r.splice(S--,1);else{s["cke:reset"]&&(p=a=h=null),u=Number(s["cke:indent"]),u!=a&&(v=d=null);if(m){if(v&&o[v][d].test(m[1]))g=v,b=d;else for(var T in o)for(var N in o[T])if(o[T][N].test(m[1])){if("ol"!=T||!/alpha|roman/.test(N)){g=T,b=N;break}if(d=/roman/.test(N)?e(m[1]):t(m[1]),!E||d<E)E=d,g=T,b=N}!g&&(g=m[2]?"ol":"ul")}else g=s["cke:listtype"]||"ol",b=s["cke:list-style-type"];v=g,d=b||("ol"==g?"decimal":"disc"),b&&b!=("ol"==g?"decimal":"disc")&&i.addStyle("list-style-type",b);if("ol"==g&&m){switch(b){case"decimal":E=Number(m[1]);break;case"lower-roman":case"upper-roman":E=e(m[1]);break;case"lower-alpha":case"upper-alpha":E=t(m[1])}i.attributes.value=E}if(p){if(u>a)n.push(p=new CKEDITOR.htmlParser.element(g)),p.add(i),h.add(p);else{if(u<a){a-=u;for(var C;a--&&(C=p.parent);)p=C.parent}p.add(i)}r.splice(S--,1)}else n.push(p=new CKEDITOR.htmlParser.element(g)),p.add(i),r[S]=p;h=i,a=u}else p&&(p=a=h=null);for(S=0;S<n.length;S++)if(p=n[S],T=p.children,d=d=void 0,N=p.children.length,C=d=void 0,r=/list-style-type:(.*?)(?:;|$)/,a=CKEDITOR.plugins.pastefromword.filters.stylesFilter,d=p.attributes,!r.exec(d.style)){for(h=0;h<N;h++)if(d=T[h],d.attributes.value&&Number(d.attributes.value)==h+1&&delete d.attributes.value,d=r.exec(d.attributes.style)){if(d[1]!=C&&!!C){C=null;break}C=d[1]}if(C){for(h=0;h<N;h++)d=T[h].attributes,d.style&&(d.style=a([["list-style-type"]])(d.style)||"");p.addStyle("list-style-type",C)}}c=l=f=null},falsyFilter:function(){return!1},stylesFilter:function(e,t){return function(n,r){var i=[];(n||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(n,s,o){s=s.toLowerCase(),"font-family"==s&&(o=o.replace(/["']/g,""));for(var u,a,f,l=0;l<e.length;l++)if(e[l]&&(n=e[l][0],u=e[l][1],a=e[l][2],f=e[l][3],s.match(n)&&(!u||o.match(u)))){s=f||s,t&&(a=a||o),"function"==typeof a&&(a=a(o,r,s)),a&&a.push&&(s=a[0],a=a[1]),"string"==typeof a&&i.push([s,a]);return}!t&&i.push([s,o])});for(var s=0;s<i.length;s++)i[s]=i[s].join(":");return i.length?i.join(";")+";":!1}},elementMigrateFilter:function(e,t){return e?function(n){var r=t?(new CKEDITOR.style(e,t))._.definition:e;n.name=r.element,CKEDITOR.tools.extend(n.attributes,CKEDITOR.tools.clone(r.attributes)),n.addStyle(CKEDITOR.style.getStyleText(r))}:function(){}},styleMigrateFilter:function(e,t){var n=this.elementMigrateFilter;return e?function(r,i){var s=new CKEDITOR.htmlParser.element(null),o={};o[t]=r,n(e,o)(s),s.children=i.children,i.children=[s],s.filter=function(){},s.parent=i}:function(){}},bogusAttrFilter:function(e,t){if(-1==t.name.indexOf("cke:"))return!1},applyStyleFilter:null},getRules:function(e,t){var n=CKEDITOR.dtd,r=CKEDITOR.tools.extend({},n.$block,n.$listItem,n.$tableContent),i=e.config,o=this.filters,u=o.falsyFilter,a=o.stylesFilter,f=o.elementMigrateFilter,l=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),c=this.utils.createListBulletMarker,h=o.flattenList,p=o.assembleList,d=this.utils.isListBulletIndicator,v=this.utils.isContainingOnlySpaces,m=this.utils.resolveList,g=function(e){return e=CKEDITOR.tools.convertToPx(e),isNaN(e)?e:e+"px"},y=this.utils.getStyleComponents,b=this.utils.listDtdParents,w=!1!==i.pasteFromWordRemoveFontStyles,E=!1!==i.pasteFromWordRemoveStyles;return{elementNames:[[/meta|link|script/,""]],root:function(e){e.filterChildren(t),p(e)},elements:{"^":function(e){var t;CKEDITOR.env.gecko&&(t=o.applyStyleFilter)&&t(e)},$:function(e){var s=e.name||"",o=e.attributes;s in r&&o.style&&(o.style=a([[/^(:?width|height)$/,null,g]])(o.style)||"");if(s.match(/h\d/)){e.filterChildren(t);if(m(e))return;f(i["format_"+s])(e)}else if(s in n.$inline)e.filterChildren(t),v(e)&&delete e.name;else if(-1!=s.indexOf(":")&&-1==s.indexOf("cke")){e.filterChildren(t);if("v:imagedata"==s){if(s=e.attributes["o:href"])e.attributes.src=s;e.name="img";return}delete e.name}s in b&&(e.filterChildren(t),p(e))},style:function(e){if(CKEDITOR.env.gecko){var e=(e=e.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/))&&e[1],t={};e&&(e.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(e,n,r){for(var n=n.split(","),e=n.length,i=0;i<e;i++)CKEDITOR.tools.trim(n[i]).replace(/^(\w+)(\.[\w-]+)?$/g,function(e,n,i){n=n||"*",i=i.substring(1,i.length),i.match(/MsoNormal/)||(t[n]||(t[n]={}),i?t[n][i]=r:t[n]=r)})}),o.applyStyleFilter=function(e){var n=t["*"]?"*":e.name,r=e.attributes&&e.attributes["class"];n in t&&(n=t[n],"object"==typeof n&&(n=n[r]),n&&e.addStyle(n,!0))})}return!1},p:function(e){if(/MsoListParagraph/i.exec(e.attributes["class"])||e.getStyle("mso-list")){var n=e.firstChild(function(e){return e.type==CKEDITOR.NODE_TEXT&&!v(e.parent)});(n=n&&n.parent)&&n.addStyle("mso-list","Ignore")}e.filterChildren(t),m(e)||(i.enterMode==CKEDITOR.ENTER_BR?(delete e.name,e.add(new CKEDITOR.htmlParser.element("br"))):f(i["format_"+(i.enterMode==CKEDITOR.ENTER_P?"p":"div")])(e))},div:function(e){var t=e.onlyChild();if(t&&"table"==t.name){var n=e.attributes;t.attributes=CKEDITOR.tools.extend(t.attributes,n),n.style&&t.addStyle(n.style),t=new CKEDITOR.htmlParser.element("div"),t.addStyle("clear","both"),e.add(t),delete e.name}},td:function(e){e.getAncestor("thead")&&(e.name="th")},ol:h,ul:h,dl:h,font:function(e){if(d(e.parent))delete e.name;else{e.filterChildren(t);var n=e.attributes,r=n.style,i=e.parent;"font"==i.name?(CKEDITOR.tools.extend(i.attributes,e.attributes),r&&i.addStyle(r),delete e.name):(r=r||"",n.color&&("#000000"!=n.color&&(r+="color:"+n.color+";"),delete n.color),n.face&&(r+="font-family:"+n.face+";",delete n.face),n.size&&(r+="font-size:"+(3<n.size?"large":3>n.size?"small":"medium")+";",delete n.size),e.name="span",e.addStyle(r))}},span:function(e){if(d(e.parent))return!1;e.filterChildren(t);if(v(e))return delete e.name,null;if(d(e)){var n=e.firstChild(function(e){return e.value||"img"==e.name}),r=(n=n&&(n.value||"l."))&&n.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);if(r)return n=c(r,n),(e=e.getAncestor("span"))&&/ mso-hide:\s*all|display:\s*none /.test(e.attributes.style)&&(n.attributes["cke:ignored"]=1),n}if(r=(n=e.attributes)&&n.style)n.style=a([["line-height"],[/^font-family$/,null,w?null:l(i.font_style,"family")],[/^font-size$/,null,w?null:l(i.fontSize_style,"size")],[/^color$/,null,w?null:l(i.colorButton_foreStyle,"color")],[/^background-color$/,null,w?null:l(i.colorButton_backStyle,"color")]])(r,e)||"";return n.style||delete n.style,CKEDITOR.tools.isEmpty(n)&&delete e.name,null},b:f(i.coreStyles_bold),i:f(i.coreStyles_italic),u:f(i.coreStyles_underline),s:f(i.coreStyles_strike),sup:f(i.coreStyles_superscript),sub:f(i.coreStyles_subscript),a:function(e){e=e.attributes,e.href&&e.href.match(/^file:\/\/\/[\S]+#/i)&&(e.href=e.href.replace(/^file:\/\/\/[^#]+/i,""))},"cke:listbullet":function(e){e.getAncestor(/h\d/)&&!i.pasteFromWordNumberedHeadingToList&&delete e.name}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:a(E?[[/^list-style-type$/,null],[/^margin$|^margin-(?!bottom|top)/,null,function(e,t,n){if(t.name in{p:1,div:1}){t="ltr"==i.contentsLangDirection?"margin-left":"margin-right";if("margin"==n)e=y(n,e,[t])[t];else if(n!=t)return null;if(e&&!s.test(e))return[t,e]}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(e,t){if("img"==t.name)return e}],[/^width|height$/,null,function(e,t){if(t.name in{table:1,td:1,th:1,img:1})return e}]]:[[/^mso-/],[/-color$/,null,function(e){if("transparent"==e)return!1;if(CKEDITOR.env.gecko)return e.replace(/-moz-use-text-color/g,"transparent")}],[/^margin$/,s],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],w?[/font-?/]:null],E),width:function(e,t){if(t.name in n.$tableContent)return!1},border:function(e,t){if(t.name in n.$tableContent)return!1},"class":u,bgcolor:u,valign:E?u:function(e,t){return t.addStyle("vertical-align",e),!1}},comment:CKEDITOR.env.ie?u:function(e,t){var n=e.match(/<img.*?>/),r=e.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);return r?(r=(n=r[1]||n&&"l.")&&n.match(/>(?:[(]?)([^\s]+?)([.)]?)</),c(r,n)):CKEDITOR.env.gecko&&n?(n=CKEDITOR.htmlParser.fragment.fromHtml(n[0]).children[0],(r=(r=(r=t.previous)&&r.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&r[1])&&(n.attributes.src=r),n):!1}}}},p=function(){this.dataFilter=new CKEDITOR.htmlParser.filter};p.prototype={toHtml:function(e){var e=CKEDITOR.htmlParser.fragment.fromHtml(e),t=new CKEDITOR.htmlParser.basicWriter;return e.writeHtml(t,this.dataFilter),t.getHtml(!0)}},CKEDITOR.cleanWord=function(e,t){CKEDITOR.env.gecko&&(e=e.replace(/(<\!--\[if[^<]*?\])--\>([\S\s]*?)<\!--(\[endif\]--\>)/gi,"$1$2$3")),CKEDITOR.env.webkit&&(e=e.replace(/(class="MsoListParagraph[^>]+><\!--\[if !supportLists\]--\>)([^<]+<span[^<]+<\/span>)(<\!--\[endif\]--\>)/gi,"$1<span>$2</span>$3"));var n=new p,r=n.dataFilter;r.addRules(CKEDITOR.plugins.pastefromword.getRules(t,r)),t.fire("beforeCleanWord",{filter:r});try{e=n.toHtml(e)}catch(i){alert(t.lang.pastefromword.error)}return e=e.replace(/cke:.*?".*?"/g,""),e=e.replace(/style=""/g,""),e=e.replace(/<span>/g,"")}})();