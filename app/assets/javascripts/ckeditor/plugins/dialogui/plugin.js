/**
 * @license Copyright (c) 2003-2014, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
/**
 * @fileOverview The "dialogui" plugin.
 */
CKEDITOR.plugins.add("dialogui",{onLoad:function(){var e=function(e){this._||(this._={}),this._["default"]=this._.initValue=e["default"]||"",this._.required=e.required||!1;var t=[this._];for(var n=1;n<arguments.length;n++)t.push(arguments[n]);return t.push(!0),CKEDITOR.tools.extend.apply(CKEDITOR.tools,t),this._},t={build:function(e,t,n){return new CKEDITOR.ui.dialog.textInput(e,t,n)}},n={build:function(e,t,n){return new CKEDITOR.ui.dialog[t.type](e,t,n)}},r={build:function(e,t,n){var r=t.children,i,s=[],o=[];for(var u=0;u<r.length&&(i=r[u]);u++){var a=[];s.push(a),o.push(CKEDITOR.dialog._.uiElementBuilders[i.type].build(e,i,a))}return new CKEDITOR.ui.dialog[t.type](e,o,s,n,t)}},i={isChanged:function(){return this.getValue()!=this.getInitValue()},reset:function(e){this.setValue(this.getInitValue(),e)},setInitValue:function(){this._.initValue=this.getValue()},resetInitValue:function(){this._.initValue=this._["default"]},getInitValue:function(){return this._.initValue}},s=CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onChange:function(e,t){this._.domOnChangeRegistered||(e.on("load",function(){this.getInputElement().on("change",function(){if(!e.parts.dialog.isVisible())return;this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",t)}},!0),o=/^on([A-Z]\w+)/,u=function(e){for(var t in e)(o.test(t)||t=="title"||t=="type")&&delete e[t];return e};CKEDITOR.tools.extend(CKEDITOR.ui.dialog,{labeledElement:function(t,n,r,i){if(arguments.length<4)return;var s=e.call(this,n);s.labelId=CKEDITOR.tools.getNextId()+"_label";var o=this._.children=[],u=function(){var e=[],r=n.required?" cke_required":"";if(n.labelLayout!="horizontal")e.push('<label class="cke_dialog_ui_labeled_label'+r+'" ',' id="'+s.labelId+'"',s.inputId?' for="'+s.inputId+'"':"",(n.labelStyle?' style="'+n.labelStyle+'"':"")+">",n.label,"</label>",'<div class="cke_dialog_ui_labeled_content"',n.controlStyle?' style="'+n.controlStyle+'"':"",' role="radiogroup" aria-labelledby="'+s.labelId+'">',i.call(this,t,n),"</div>");else{var o={type:"hbox",widths:n.widths,padding:0,children:[{type:"html",html:'<label class="cke_dialog_ui_labeled_label'+r+'"'+' id="'+s.labelId+'"'+' for="'+s.inputId+'"'+(n.labelStyle?' style="'+n.labelStyle+'"':"")+">"+CKEDITOR.tools.htmlEncode(n.label)+"</span>"},{type:"html",html:'<span class="cke_dialog_ui_labeled_content"'+(n.controlStyle?' style="'+n.controlStyle+'"':"")+">"+i.call(this,t,n)+"</span>"}]};CKEDITOR.dialog._.uiElementBuilders.hbox.build(t,o,e)}return e.join("")};CKEDITOR.ui.dialog.uiElement.call(this,t,n,r,"div",null,{role:"presentation"},u)},textInput:function(t,n,r){if(arguments.length<3)return;e.call(this,n);var i=this._.inputId=CKEDITOR.tools.getNextId()+"_textInput",s={"class":"cke_dialog_ui_input_"+n.type,id:i,type:n.type},o;n.validate&&(this.validate=n.validate),n.maxLength&&(s.maxlength=n.maxLength),n.size&&(s.size=n.size),n.inputStyle&&(s.style=n.inputStyle);var u=this,a=!1;t.on("load",function(){u.getInputElement().on("keydown",function(e){e.data.getKeystroke()==13&&(a=!0)}),u.getInputElement().on("keyup",function(e){e.data.getKeystroke()==13&&a&&(t.getButton("ok")&&setTimeout(function(){t.getButton("ok").click()},0),a=!1)},null,null,1e3)});var f=function(){var e=['<div class="cke_dialog_ui_input_',n.type,'" role="presentation"'];n.width&&e.push('style="width:'+n.width+'" '),e.push("><input "),s["aria-labelledby"]=this._.labelId,this._.required&&(s["aria-required"]=this._.required);for(var t in s)e.push(t+'="'+s[t]+'" ');return e.push(" /></div>"),e.join("")};CKEDITOR.ui.dialog.labeledElement.call(this,t,n,r,f)},textarea:function(t,n,r){if(arguments.length<3)return;e.call(this,n);var i=this,s=this._.inputId=CKEDITOR.tools.getNextId()+"_textarea",o={};n.validate&&(this.validate=n.validate),o.rows=n.rows||5,o.cols=n.cols||20,o["class"]="cke_dialog_ui_input_textarea "+(n["class"]||""),typeof n.inputStyle!="undefined"&&(o.style=n.inputStyle),n.dir&&(o.dir=n.dir);var u=function(){o["aria-labelledby"]=this._.labelId,this._.required&&(o["aria-required"]=this._.required);var e=['<div class="cke_dialog_ui_input_textarea" role="presentation"><textarea id="',s,'" '];for(var t in o)e.push(t+'="'+CKEDITOR.tools.htmlEncode(o[t])+'" ');return e.push(">",CKEDITOR.tools.htmlEncode(i._["default"]),"</textarea></div>"),e.join("")};CKEDITOR.ui.dialog.labeledElement.call(this,t,n,r,u)},checkbox:function(t,n,r){if(arguments.length<3)return;var i=e.call(this,n,{"default":!!n["default"]});n.validate&&(this.validate=n.validate);var s=function(){var e=CKEDITOR.tools.extend({},n,{id:n.id?n.id+"_checkbox":CKEDITOR.tools.getNextId()+"_checkbox"},!0),r=[],s=CKEDITOR.tools.getNextId()+"_label",o={"class":"cke_dialog_ui_checkbox_input",type:"checkbox","aria-labelledby":s};return u(e),n["default"]&&(o.checked="checked"),typeof e.inputStyle!="undefined"&&(e.style=e.inputStyle),i.checkbox=new CKEDITOR.ui.dialog.uiElement(t,e,r,"input",null,o),r.push(' <label id="',s,'" for="',o.id,'"'+(n.labelStyle?' style="'+n.labelStyle+'"':"")+">",CKEDITOR.tools.htmlEncode(n.label),"</label>"),r.join("")};CKEDITOR.ui.dialog.uiElement.call(this,t,n,r,"span",null,null,s)},radio:function(t,n,r){if(arguments.length<3)return;e.call(this,n),this._["default"]||(this._["default"]=this._.initValue=n.items[0][1]),n.validate&&(this.validate=n.valdiate);var i=[],s=this,o=function(){var e=[],r=[],o=(n.id?n.id:CKEDITOR.tools.getNextId())+"_radio";for(var a=0;a<n.items.length;a++){var f=n.items[a],l=f[2]!==undefined?f[2]:f[0],c=f[1]!==undefined?f[1]:f[0],h=CKEDITOR.tools.getNextId()+"_radio_input",p=h+"_label",d=CKEDITOR.tools.extend({},n,{id:h,title:null,type:null},!0),v=CKEDITOR.tools.extend({},d,{title:l},!0),m={type:"radio","class":"cke_dialog_ui_radio_input",name:o,value:c,"aria-labelledby":p},g=[];s._["default"]==c&&(m.checked="checked"),u(d),u(v),typeof d.inputStyle!="undefined"&&(d.style=d.inputStyle),d.keyboardFocusable=!0,i.push(new CKEDITOR.ui.dialog.uiElement(t,d,g,"input",null,m)),g.push(" "),new CKEDITOR.ui.dialog.uiElement(t,v,g,"label",null,{id:p,"for":m.id},f[0]),e.push(g.join(""))}return new CKEDITOR.ui.dialog.hbox(t,i,e,r),r.join("")};CKEDITOR.ui.dialog.labeledElement.call(this,t,n,r,o),this._.children=i},button:function(t,n,r){if(!arguments.length)return;typeof n=="function"&&(n=n(t.getParentEditor())),e.call(this,n,{disabled:n.disabled||!1}),CKEDITOR.event.implementOn(this);var i=this;t.on("load",function(e){var t=this.getElement();(function(){t.on("click",function(e){i.click(),e.data.preventDefault()}),t.on("keydown",function(e){e.data.getKeystroke()in{32:1}&&(i.click(),e.data.preventDefault())})})(),t.unselectable()},this);var s=CKEDITOR.tools.extend({},n);delete s.style;var o=CKEDITOR.tools.getNextId()+"_label";CKEDITOR.ui.dialog.uiElement.call(this,t,s,r,"a",null,{style:n.style,href:"javascript:void(0)",title:n.label,hidefocus:"true","class":n["class"],role:"button","aria-labelledby":o},'<span id="'+o+'" class="cke_dialog_ui_button">'+CKEDITOR.tools.htmlEncode(n.label)+"</span>")},select:function(t,n,r){if(arguments.length<3)return;var i=e.call(this,n);n.validate&&(this.validate=n.validate),i.inputId=CKEDITOR.tools.getNextId()+"_select";var s=function(){var e=CKEDITOR.tools.extend({},n,{id:n.id?n.id+"_select":CKEDITOR.tools.getNextId()+"_select"},!0),r=[],s=[],o={id:i.inputId,"class":"cke_dialog_ui_input_select","aria-labelledby":this._.labelId};r.push('<div class="cke_dialog_ui_input_',n.type,'" role="presentation"'),n.width&&r.push('style="width:'+n.width+'" '),r.push(">"),n.size!=undefined&&(o.size=n.size),n.multiple!=undefined&&(o.multiple=n.multiple),u(e);for(var a=0,f;a<n.items.length&&(f=n.items[a]);a++)s.push('<option value="',CKEDITOR.tools.htmlEncode(f[1]!==undefined?f[1]:f[0]).replace(/"/g,"&quot;"),'" /> ',CKEDITOR.tools.htmlEncode(f[0]));return typeof e.inputStyle!="undefined"&&(e.style=e.inputStyle),i.select=new CKEDITOR.ui.dialog.uiElement(t,e,r,"select",null,o,s.join("")),r.push("</div>"),r.join("")};CKEDITOR.ui.dialog.labeledElement.call(this,t,n,r,s)},file:function(t,n,r){if(arguments.length<3)return;n["default"]===undefined&&(n["default"]="");var i=CKEDITOR.tools.extend(e.call(this,n),{definition:n,buttons:[]});n.validate&&(this.validate=n.validate);var s=function(){i.frameId=CKEDITOR.tools.getNextId()+"_fileInput";var e=['<iframe frameborder="0" allowtransparency="0" class="cke_dialog_ui_input_file" role="presentation" id="',i.frameId,'" title="',n.label,'" src="javascript:void('];return e.push(CKEDITOR.env.ie?"(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();"+"document.close();")+"})()":"0"),e.push(')"></iframe>'),e.join("")};t.on("load",function(){var e=CKEDITOR.document.getById(i.frameId),t=e.getParent();t.addClass("cke_dialog_ui_input_file")}),CKEDITOR.ui.dialog.labeledElement.call(this,t,n,r,s)},fileButton:function(t,n,r){if(arguments.length<3)return;var i=e.call(this,n),s=this;n.validate&&(this.validate=n.validate);var o=CKEDITOR.tools.extend({},n),u=o.onClick;o.className=(o.className?o.className+" ":"")+"cke_dialog_ui_button",o.onClick=function(e){var r=n["for"];if(!u||u.call(this,e)!==!1)t.getContentElement(r[0],r[1]).submit(),this.disable()},t.on("load",function(){t.getContentElement(n["for"][0],n["for"][1])._.buttons.push(s)}),CKEDITOR.ui.dialog.button.call(this,t,o,r)},html:function(){var e=/^\s*<[\w:]+\s+([^>]*)?>/,t=/^(\s*<[\w:]+(?:\s+[^>]*)?)((?:.|\r|\n)+)$/,n=/\/$/;return function(r,i,s){if(arguments.length<3)return;var o=[],u,a=i.html,f,l;a.charAt(0)!="<"&&(a="<span>"+a+"</span>");var c=i.focus;if(c){var h=this.focus;this.focus=function(){(typeof c=="function"?c:h).call(this),this.fire("focus")};if(i.isFocusable){var p=this.isFocusable;this.isFocusable=p}this.keyboardFocusable=!0}CKEDITOR.ui.dialog.uiElement.call(this,r,i,o,"span",null,null,""),u=o.join(""),f=u.match(e),l=a.match(t)||["","",""],n.test(l[1])&&(l[1]=l[1].slice(0,-1),l[2]="/"+l[2]),s.push([l[1]," ",f[1]||"",l[2]].join(""))}}(),fieldset:function(e,t,n,r,i){var s=i.label,o=function(){var e=[];s&&e.push("<legend"+(i.labelStyle?' style="'+i.labelStyle+'"':"")+">"+s+"</legend>");for(var t=0;t<n.length;t++)e.push(n[t]);return e.join("")};this._={children:t},CKEDITOR.ui.dialog.uiElement.call(this,e,i,r,"fieldset",null,null,o)}},!0),CKEDITOR.ui.dialog.html.prototype=new CKEDITOR.ui.dialog.uiElement,CKEDITOR.ui.dialog.labeledElement.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setLabel:function(e){var t=CKEDITOR.document.getById(this._.labelId);return t.getChildCount()<1?(new CKEDITOR.dom.text(e,CKEDITOR.document)).appendTo(t):t.getChild(0).$.nodeValue=e,this},getLabel:function(){var e=CKEDITOR.document.getById(this._.labelId);return!e||e.getChildCount()<1?"":e.getChild(0).getText()},eventProcessors:s},!0),CKEDITOR.ui.dialog.button.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{click:function(){return this._.disabled?!1:this.fire("click",{dialog:this._.dialog})},enable:function(){this._.disabled=!1;var e=this.getElement();e&&e.removeClass("cke_disabled")},disable:function(){this._.disabled=!0,this.getElement().addClass("cke_disabled")},isVisible:function(){return this.getElement().getFirst().isVisible()},isEnabled:function(){return!this._.disabled},eventProcessors:CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onClick:function(e,t){this.on("click",function(){t.apply(this,arguments)})}},!0),accessKeyUp:function(){this.click()},accessKeyDown:function(){this.focus()},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.textInput.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return CKEDITOR.document.getById(this._.inputId)},focus:function(){var e=this.selectParentTab();setTimeout(function(){var t=e.getInputElement();t&&t.$.focus()},0)},select:function(){var e=this.selectParentTab();setTimeout(function(){var t=e.getInputElement();t&&(t.$.focus(),t.$.select())},0)},accessKeyUp:function(){this.select()},setValue:function(e){return!e&&(e=""),CKEDITOR.ui.dialog.uiElement.prototype.setValue.apply(this,arguments)},keyboardFocusable:!0},i,!0),CKEDITOR.ui.dialog.textarea.prototype=new CKEDITOR.ui.dialog.textInput,CKEDITOR.ui.dialog.select.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return this._.select.getElement()},add:function(e,t,n){var r=new CKEDITOR.dom.element("option",this.getDialog().getParentEditor().document),i=this.getInputElement().$;return r.$.text=e,r.$.value=t===undefined||t===null?e:t,n===undefined||n===null?CKEDITOR.env.ie?i.add(r.$):i.add(r.$,null):i.add(r.$,n),this},remove:function(e){var t=this.getInputElement().$;return t.remove(e),this},clear:function(){var e=this.getInputElement().$;while(e.length>0)e.remove(0);return this},keyboardFocusable:!0},i,!0),CKEDITOR.ui.dialog.checkbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getInputElement:function(){return this._.checkbox.getElement()},setValue:function(e,t){this.getInputElement().$.checked=e,!t&&this.fire("change",{value:e})},getValue:function(){return this.getInputElement().$.checked},accessKeyUp:function(){this.setValue(!this.getValue())},eventProcessors:{onChange:function(e,t){return!CKEDITOR.env.ie||CKEDITOR.env.version>8?s.onChange.apply(this,arguments):(e.on("load",function(){var e=this._.checkbox.getElement();e.on("propertychange",function(t){t=t.data.$,t.propertyName=="checked"&&this.fire("change",{value:e.$.checked})},this)},this),this.on("change",t),null)}},keyboardFocusable:!0},i,!0),CKEDITOR.ui.dialog.radio.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setValue:function(e,t){var n=this._.children,r;for(var i=0;i<n.length&&(r=n[i]);i++)r.getElement().$.checked=r.getValue()==e;!t&&this.fire("change",{value:e})},getValue:function(){var e=this._.children;for(var t=0;t<e.length;t++)if(e[t].getElement().$.checked)return e[t].getValue();return null},accessKeyUp:function(){var e=this._.children,t;for(t=0;t<e.length;t++)if(e[t].getElement().$.checked){e[t].getElement().focus();return}e[0].getElement().focus()},eventProcessors:{onChange:function(e,t){return CKEDITOR.env.ie?(e.on("load",function(){var e=this._.children,t=this;for(var n=0;n<e.length;n++){var r=e[n].getElement();r.on("propertychange",function(e){e=e.data.$,e.propertyName=="checked"&&this.$.checked&&t.fire("change",{value:this.getAttribute("value")})})}},this),this.on("change",t),null):s.onChange.apply(this,arguments)}}},i,!0),CKEDITOR.ui.dialog.file.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,i,{getInputElement:function(){var e=CKEDITOR.document.getById(this._.frameId).getFrameDocument();return e.$.forms.length>0?new CKEDITOR.dom.element(e.$.forms[0].elements[0]):this.getElement()},submit:function(){return this.getInputElement().getParent().$.submit(),this},getAction:function(){return this.getInputElement().getParent().$.action},registerEvents:function(e){var t=/^on([A-Z]\w+)/,n,r=function(e,t,n,r){e.on("formLoaded",function(){e.getInputElement().on(n,r,e)})};for(var i in e){if(!(n=i.match(t)))continue;this.eventProcessors[i]?this.eventProcessors[i].call(this,this._.dialog,e[i]):r(this,this._.dialog,n[1].toLowerCase(),e[i])}return this},reset:function(){function f(){n.$.open();var t="";r.size&&(t=r.size-(CKEDITOR.env.ie?7:0));var f=e.frameId+"_input";n.$.write(['<html dir="'+u+'" lang="'+a+'"><head><title></title></head><body style="margin: 0; overflow: hidden; background: transparent;">','<form enctype="multipart/form-data" method="POST" dir="'+u+'" lang="'+a+'" action="',CKEDITOR.tools.htmlEncode(r.action),'">','<label id="',e.labelId,'" for="',f,'" style="display:none">',CKEDITOR.tools.htmlEncode(r.label),"</label>",'<input style="width:100%" id="',f,'" aria-labelledby="',e.labelId,'" type="file" name="',CKEDITOR.tools.htmlEncode(r.id||"cke_upload"),'" size="',CKEDITOR.tools.htmlEncode(t>0?t:""),'" />',"</form>","</body></html>","<script>",CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"","window.parent.CKEDITOR.tools.callFunction("+s+");","window.onbeforeunload = function() {window.parent.CKEDITOR.tools.callFunction("+o+")}","</script>"].join("")),n.$.close();for(var l=0;l<i.length;l++)i[l].enable()}var e=this._,t=CKEDITOR.document.getById(e.frameId),n=t.getFrameDocument(),r=e.definition,i=e.buttons,s=this.formLoadedNumber,o=this.formUnloadNumber,u=e.dialog._.editor.lang.dir,a=e.dialog._.editor.langCode;s||(s=this.formLoadedNumber=CKEDITOR.tools.addFunction(function(){this.fire("formLoaded")},this),o=this.formUnloadNumber=CKEDITOR.tools.addFunction(function(){this.getInputElement().clearCustomData()},this),this.getDialog()._.editor.on("destroy",function(){CKEDITOR.tools.removeFunction(s),CKEDITOR.tools.removeFunction(o)})),CKEDITOR.env.gecko?setTimeout(f,500):f()},getValue:function(){return this.getInputElement().$.value||""},setInitValue:function(){this._.initValue=""},eventProcessors:{onChange:function(e,t){this._.domOnChangeRegistered||(this.on("formLoaded",function(){this.getInputElement().on("change",function(){this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",t)}},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.fileButton.prototype=new CKEDITOR.ui.dialog.button,CKEDITOR.ui.dialog.fieldset.prototype=CKEDITOR.tools.clone(CKEDITOR.ui.dialog.hbox.prototype),CKEDITOR.dialog.addUIElement("text",t),CKEDITOR.dialog.addUIElement("password",t),CKEDITOR.dialog.addUIElement("textarea",n),CKEDITOR.dialog.addUIElement("checkbox",n),CKEDITOR.dialog.addUIElement("radio",n),CKEDITOR.dialog.addUIElement("button",n),CKEDITOR.dialog.addUIElement("select",n),CKEDITOR.dialog.addUIElement("file",n),CKEDITOR.dialog.addUIElement("fileButton",n),CKEDITOR.dialog.addUIElement("html",n),CKEDITOR.dialog.addUIElement("fieldset",r)}});