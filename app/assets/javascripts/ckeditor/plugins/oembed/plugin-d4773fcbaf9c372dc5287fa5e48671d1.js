/**
* oEmbed Plugin plugin
* Licensed under the MIT license
* jQuery Embed Plugin: http://code.google.com/p/jquery-oembed/ (MIT License)
* Plugin for: http://ckeditor.com/license (GPL/LGPL/MPL: http://ckeditor.com/license)
*/
(function(){CKEDITOR.plugins.add("oembed",{icons:"oembed",hidpi:!0,requires:"widget,dialog",lang:"pt-br",version:1.15,init:function(e){function n(){typeof jQuery=="undefined"?CKEDITOR.scriptLoader.load("//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js",function(){jQuery.noConflict(),typeof jQuery.fn.oembed=="undefined"&&CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(CKEDITOR.plugins.getPath("oembed")+"libs/jquery.oembed.min.js"))}):typeof jQuery.fn.oembed=="undefined"&&CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(CKEDITOR.plugins.getPath("oembed")+"libs/jquery.oembed.min.js"))}function r(t,n,r,i,s,o,u,a){jQuery("body").oembed(t,{onEmbed:function(n){var s=!1;a.element.data("resizeType",o);if(o=="responsive"||o=="custom")a.element.data("maxWidth",r),a.element.data("maxHeight",i);a.element.data("align",u),u=="center"?(a.inline||a.element.setStyle("text-align","center"),a.element.removeStyle("float")):u=="right"?(a.inline||a.element.setStyle("text-align","right"),a.element.removeStyle("float")):(a.inline||a.element.removeStyle("text-align"),u=="none"?a.element.removeStyle("float"):a.element.setStyle("float",u)),typeof n.code=="string"?(a.element.$.firstChild&&a.element.$.removeChild(a.element.$.firstChild),a.element.appendHtml(n.code),a.element.data("oembed",t),s=!0):typeof n.code[0].outerHTML=="string"?(a.element.$.firstChild&&a.element.$.removeChild(a.element.$.firstChild),a.element.appendHtml(n.code[0].outerHTML),a.element.data("oembed",t),s=!0):alert(e.lang.oembed.noEmbedCode)},onError:function(t){t.indexOf("vimeo.com")>0?alert(e.lang.oembed.noVimeo):alert(e.lang.oembed.Error)},maxHeight:i,maxWidth:r,useResponsiveResize:s,embedMethod:"editor"})}n(),CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{oEmbed:function(t,n,i,s){function o(){if(n==null||n=="undefined")n=null;if(i==null||i=="undefined")i=null;if(s==null||s=="undefined")s=!1;r(t,e,!1,n,i,s)}return t.length<1||t.indexOf("http")<0?(alert(e.lang.oembed.invalidUrl),!1):(typeof jQuery.fn.oembed=="undefined"?CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(CKEDITOR.plugins.getPath("oembed")+"libs/jquery.oembed.min.js"),function(){o()}):o(),!0)}}),e.widgets.add("oembed",{draggable:!1,mask:!0,dialog:"oembed",allowedContent:{div:{styles:"text-align,float",attributes:"*",classes:e.config.oembed_WrapperClass!=null?e.config.oembed_WrapperClass:"embeddedContent"},"div iframe":{attributes:"*"}},template:'<div class="'+(e.config.oembed_WrapperClass!=null?e.config.oembed_WrapperClass:"embeddedContent")+'">'+"</div>",upcast:function(t){return t.name=="div"&&t.hasClass(e.config.oembed_WrapperClass!=null?e.config.oembed_WrapperClass:"embeddedContent")},init:function(){var e={oembed:this.element.data("oembed")||"",resizeType:this.element.data("resizeType")||"noresize",maxWidth:this.element.data("maxWidth")||560,maxHeight:this.element.data("maxHeight")||315,align:this.element.data("align")||"none"};this.setData(e),this.on("dialog",function(e){e.data.widget=this},this)}}),e.ui.addButton("oembed",{label:e.lang.oembed.button,command:"oembed",toolbar:"insert,10",icon:this.path+"icons/"+(CKEDITOR.env.hidpi?"hidpi/":"")+"oembed.png"});var t=function(){var e=this.getDialog(),t=this.getValue(),n=e.getContentElement("general","maxSizeBox").getElement(),r=e.getContentElement("general","sizeBox").getElement();t=="noresize"?(n.hide(),r.hide()):t=="custom"?(n.hide(),r.show()):(n.show(),r.hide())};String.prototype.beginsWith=function(e){return this.indexOf(e)===0},CKEDITOR.dialog.add("oembed",function(e){return{title:e.lang.oembed.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:CKEDITOR.env.ie&&CKEDITOR.env.quirks?568:550,minHeight:155,onShow:function(){var e={oembed:this.widget.element.data("oembed")||"",resizeType:this.widget.element.data("resizeType")||"noresize",maxWidth:this.widget.element.data("maxWidth")||560,maxHeight:this.widget.element.data("maxHeight")||315,align:this.widget.element.data("align")||"none"};this.widget.setData(e),this.getContentElement("general","resizeType").setValue(e.resizeType),this.getContentElement("general","align").setValue(e.align);var t=this.getContentElement("general","resizeType").getValue(),n=this.getContentElement("general","maxSizeBox").getElement(),r=this.getContentElement("general","sizeBox").getElement();t=="noresize"?(n.hide(),r.hide()):t=="custom"?(n.hide(),r.show()):(n.show(),r.hide())},onOk:function(){},contents:[{label:e.lang.common.generalTab,id:"general",elements:[{type:"html",id:"oembedHeader",html:'<div style="white-space:normal;width:500px;padding-bottom:10px">'+e.lang.oembed.pasteUrl+"</div>"},{type:"text",id:"embedCode",focus:function(){this.getElement().focus()},label:e.lang.oembed.url,title:e.lang.oembed.pasteUrl,setup:function(e){e.data.oembed&&this.setValue(e.data.oembed)},commit:function(t){var n=CKEDITOR.dialog.getCurrent(),i=n.getValueOf("general","embedCode").replace(/\s/g,""),s=n.getContentElement("general","resizeType").getValue(),o=n.getContentElement("general","align").getValue(),u=null,a=null,f=!1,l=n.getParentEditor();if(i.length<1||i.indexOf("http")<0)return alert(e.lang.oembed.invalidUrl),!1;s=="noresize"?(f=!1,u="560px",a="315px"):s=="responsive"?(u=n.getContentElement("general","maxWidth").getInputElement().getValue(),a=n.getContentElement("general","maxHeight").getInputElement().getValue(),f=!0):s=="custom"&&(u=n.getContentElement("general","width").getInputElement().getValue(),a=n.getContentElement("general","height").getInputElement().getValue(),f=!1),r(i,l,u,a,f,s,o,t),t.setData("oembed",i),t.setData("resizeType",s),t.setData("align",o),t.setData("maxWidth",u),t.setData("maxHeight",a)}},{type:"hbox",widths:["50%","50%"],children:[{id:"resizeType",type:"select",label:e.lang.oembed.resizeType,"default":"noresize",setup:function(e){e.data.resizeType&&this.setValue(e.data.resizeType)},items:[[e.lang.oembed.noresize,"noresize"],[e.lang.oembed.responsive,"responsive"],[e.lang.oembed.custom,"custom"]],onChange:t},{type:"hbox",id:"maxSizeBox",widths:["120px","120px"],style:"float:left;position:absolute;left:58%;width:200px",children:[{type:"text",width:"100px",id:"maxWidth","default":e.config.oembed_maxWidth!=null?e.config.oembed_maxWidth:"560",label:e.lang.oembed.maxWidth,title:e.lang.oembed.maxWidthTitle,setup:function(e){e.data.maxWidth&&this.setValue(e.data.maxWidth)}},{type:"text",id:"maxHeight",width:"120px","default":e.config.oembed_maxHeight!=null?e.config.oembed_maxHeight:"315",label:e.lang.oembed.maxHeight,title:e.lang.oembed.maxHeightTitle,setup:function(e){e.data.maxHeight&&this.setValue(e.data.maxHeight)}}]},{type:"hbox",id:"sizeBox",widths:["120px","120px"],style:"float:left;position:absolute;left:58%;width:200px",children:[{type:"text",id:"width",width:"100px","default":e.config.oembed_maxWidth!=null?e.config.oembed_maxWidth:"560",label:e.lang.oembed.width,title:e.lang.oembed.widthTitle,setup:function(e){e.data.maxWidth&&this.setValue(e.data.maxWidth)}},{type:"text",id:"height",width:"120px","default":e.config.oembed_maxHeight!=null?e.config.oembed_maxHeight:"315",label:e.lang.oembed.height,title:e.lang.oembed.heightTitle,setup:function(e){e.data.maxHeight&&this.setValue(e.data.maxHeight)}}]}]},{type:"hbox",id:"alignment",children:[{id:"align",type:"radio",items:[[e.lang.oembed.none,"none"],[e.lang.common.alignLeft,"left"],[e.lang.common.alignCenter,"center"],[e.lang.common.alignRight,"right"]],label:e.lang.common.align,setup:function(e){this.setValue(e.data.align)}}]}]}]}})}})})();