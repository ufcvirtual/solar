%section.discussion
  .block_title
    %h2= t(:discussions_participation, :scope => [:scores, :info])
    #tabs.tab_discussion
      %ul
        %li= link_to t(:evaluative, scope: [:scores, :info]), '#', class: 'evaluative active', onclick: 'change_tab_tool(this); return false;', :'data-div' => '#evaluative', onkeydown: 'click_on_keypress(event, this);'
        %li= link_to t(:frequency, scope: [:scores, :info]), '#', class: 'frequency', onclick: 'change_tab_tool(this); return false;', :'data-div' => "#frequency", onkeydown: 'click_on_keypress(event, this);'
        %li= link_to t(:not_evaluative, scope: [:scores, :info]), '#', class: 'notevaluative', onclick: 'change_tab_tool(this); return false;', :'data-div' => "#notevaluative", onkeydown: 'click_on_keypress(event, this);'

  .block_content
    .tools.show#evaluative    
      - unless @discussions_evaluative.empty?
        %table.tb_list
          %thead
            %tr.lines
              %th{style: "width: 30%;"}= t(:discussions, scope: [:scores, :info])
              %th.center.date{style: "width: 30%;"}= t(:date_range, scope: [:scores, :info])
              %th.center{style: "width: 20%;"}= t(:situation, :scope => [:scores, :info])
              %th.center{style: "width: 2%;"}= t(:amount, scope: [:scores, :info])
              - if @is_student
                %th.center{style: "width: 2%;"}= t(:grade, scope: [:scores, :info])
              - if @can_evaluate && @is_student
                %th.center.no_sort{style: "width: 2%;"}
              - else
                %th.center.no_sort{style: "width: 2%;"}=t(:discussions_participation, scope: [:scores, :info])
              %th.center.no_sort{style: "width: 2%;"}=t('scores.info.new_after_evaluation')
          %tbody
            - @discussions_evaluative.each do |discussion|
              %tr.lines
                %td
                  - if discussion.opened == 't'
                    = link_to discussion.name, discussion_posts_path(discussion.academic_tool_id), {class: 'link_content', onkeydown: 'click_on_keypress(event, this);'}
                  - else
                    .title= discussion.name
                  .description
                    .minimun= sanitize(truncate discussion.description, length: 100, omission: "#{content_tag(:i, nil, class: 'expand icon-ellipsis', :"data-tooltip" => t(".expand_description"))}")
                    .complete.invisible
                      = discussion.description
                      = content_tag(:i, nil, class: "compress icon-arrow-up-triangle", :"data-tooltip" => t(".compress_description"))
                  .equivalent
                    - unless discussion.eq_name.blank?
                      %a{ href: '#', :"data-dropdown" => "#dropdown_eq_1_#{discussion.id}", onkeydown: 'click_on_keypress(event, this);' }
                        %i.icon-flow-parallel
                        = t('scores.info.equivalency')
                        %i.icon-arrow-down-triangle
                      .dropdown.dropdown-tip{id: "dropdown_eq_1_#{discussion.id}"}
                        %ul{ class: 'dropdown-menu' }
                          = raw t('scores.info.equivalent', name: discussion.eq_name)
                    - else
                      %a{ href: '#', :"data-dropdown" => "#dropdown_eq_1_#{discussion.id}", :'data-url' => equalities_tools_path(tool_type: discussion.academic_tool_type, ac_id: discussion.id), onclick: 'open_dropdown(this);' , onkeydown: 'click_on_keypress(event, this);'}
                        %i.icon-flow-parallel
                        =t('scores.info.equalities')
                        %i.icon-arrow-down-triangle
                      .dropdown.dropdown-tip{id: "dropdown_eq_1_#{discussion.id}"}
                        %ul{ class: 'dropdown-menu' }
                %td.center
                  = [l(discussion.start_date.to_date), l(discussion.end_date.to_date)].join(' - ')
                %td.center{class: "assignment_#{discussion.situation}"}= t("scores.situation.#{discussion.situation}")
                %td.center= discussion.count
                - if @is_student
                  %td.center= discussion.grade
                %td.center= link_to content_tag(:i, nil, class: "icon-#{@can_evaluate && @is_student ? 'write' : 'text'}"), user_discussion_posts_path(discussion.academic_tool_id, @user.id), class: 'btn to_evaluate_post', :'data-tooltip'=> t(:to_evaluate, scope: [:posts, :post]) , onkeydown: 'click_on_keypress(event, this);'
                %td.center=(discussion.new_after_evaluation == 't' ? t('scores.info.new_yes') : t('scores.info.new_no'))
      - else
        .block_content.block_content_text= t(:itens_not_found)

    .tools#frequency
      - unless @discussions_frequency.empty?
        %table.tb_list
          %thead
            %tr.lines
              %th{style: "width: 30%;"}= t(:discussions, scope: [:scores, :info])
              %th.center.date{style: "width: 30%;"}= t(:date_range, scope: [:scores, :info])
              %th.center{style: "width: 20%;"}= t(:situation, :scope => [:scores, :info])
              %th.center{style: "width: 2%;"}= t(:amount, scope: [:scores, :info])
              - if @is_student
                %th.center{style: "width: 2%;"}= t(:frequency, scope: [:scores, :info])
              - if @can_evaluate && @is_student
                %th.center.no_sort{style: "width: 2%;"}
              - else
                %th.center.no_sort{style: "width: 2%;"}=t(:discussions_participation, scope: [:scores, :info])
              %th.center.no_sort{style: "width: 2%;"}=t('scores.info.new_after_evaluation')
          %tbody
            - @discussions_frequency.each do |discussion|
              %tr.lines
                %td
                  - if discussion.opened == 't'
                    = link_to discussion.name, discussion_posts_path(discussion.academic_tool_id), {class: 'link_content', onkeydown: 'click_on_keypress(event, this);'}
                  - else
                    .title= discussion.name
                  .description
                    .minimun= sanitize(truncate discussion.description, length: 100, omission: "#{content_tag(:i, nil, class: 'expand icon-ellipsis', :"data-tooltip" => t(".expand_description"))}")
                    .complete.invisible
                      = discussion.description
                      = content_tag(:i, nil, class: "compress icon-arrow-up-triangle", :"data-tooltip" => t(".compress_description"))
                  .equivalent
                    - unless discussion.eq_name.blank?
                      %a{ href: '#', :"data-dropdown" => "#dropdown_eq_2_#{discussion.id}", onkeydown: 'click_on_keypress(event, this);' }
                        %i.icon-flow-parallel
                        = t('scores.info.equivalency')
                        %i.icon-arrow-down-triangle
                      .dropdown.dropdown-tip{id: "dropdown_eq_2_#{discussion.id}"}
                        %ul{ class: 'dropdown-menu' }
                          = raw t('scores.info.equivalent', name: discussion.eq_name)
                    - else
                      %a{ href: '#', :"data-dropdown" => "#dropdown_eq_2_#{discussion.id}", :'data-url' => equalities_tools_path(tool_type: discussion.academic_tool_type, ac_id: discussion.id), onclick: 'open_dropdown(this);', onkeydown: 'click_on_keypress(event, this);' }
                        %i.icon-flow-parallel
                        =t('scores.info.equalities')
                        %i.icon-arrow-down-triangle
                      .dropdown.dropdown-tip{id: "dropdown_eq_2_#{discussion.id}"}
                        %ul{ class: 'dropdown-menu' }
                %td.center= [l(discussion.start_date.to_date), l(discussion.end_date.to_date)].join(' - ')   
                %td.center{class: "assignment_#{discussion.situation}"}= t("scores.situation.#{discussion.situation}")
                %td.center= discussion.count
                - if @is_student
                  %td.center= discussion.working_hours
                %td.center= link_to content_tag(:i, nil, class: "icon-#{@can_evaluate && @is_student ? 'write' : 'text'}"), user_discussion_posts_path(discussion.academic_tool_id, @user.id), class: 'btn to_evaluate_post', :'data-tooltip'=> t(:to_evaluate, scope: [:posts, :post]), onkeydown: 'click_on_keypress(event, this);'
                %td.center=(discussion.new_after_evaluation == 't' ? t('scores.info.new_yes') : t('scores.info.new_no'))
      - else
        .block_content.block_content_text= t(:itens_not_found)

    .tools#notevaluative
      - unless @discussions_not_evaluative.empty?
        %table.tb_list
          %thead
            %tr.lines
              %th{style: "width: 60%;"}= t(:discussions, scope: [:scores, :info])
              %th.center.date{style: "width: 40%;"}= t(:date_range, scope: [:scores, :info])
              %th.center{style: "width: 20%;"}= t(:situation, :scope => [:scores, :info])
              %th.center{style: "width: 2%;"}= t(:amount, scope: [:scores, :info])
              %th.center.no_sort{style: "width: 2%;"}=t(:discussions_participation, scope: [:scores, :info])
          %tbody
            - @discussions_not_evaluative.each do |discussion|
              %tr.lines
                %td
                  - if discussion.opened == 't'
                    = link_to discussion.name, discussion_posts_path(discussion.academic_tool_id), {class: 'link_content', onkeydown: 'click_on_keypress(event, this);'}
                  - else
                    .title= discussion.name
                  .description
                    .minimun= sanitize(truncate discussion.description, length: 100, omission: "#{content_tag(:i, nil, class: 'expand icon-ellipsis', :"data-tooltip" => t(".expand_description"))}")
                    .complete.invisible
                      = discussion.description
                      = content_tag(:i, nil, class: "compress icon-arrow-up-triangle", :"data-tooltip" => t(".compress_description"))
                  .equivalent
                    - unless discussion.eq_name.blank?
                      %a{ href: '#', :"data-dropdown" => "#dropdown_eq_3_#{discussion.id}", onkeydown: 'click_on_keypress(event, this);' }
                        %i.icon-flow-parallel
                        = t('scores.info.equivalency')
                        %i.icon-arrow-down-triangle
                      .dropdown.dropdown-tip{id: "dropdown_eq_3_#{discussion.id}"}
                        %ul{ class: 'dropdown-menu' }
                          = raw t('scores.info.equivalent', name: discussion.eq_name)
                    - else
                      %a{ href: '#', :"data-dropdown" => "#dropdown_eq_3_#{discussion.id}", :'data-url' => equalities_tools_path(tool_type: discussion.academic_tool_type, ac_id: discussion.id), onclick: 'open_dropdown(this);', onkeydown: 'click_on_keypress(event, this);' }
                        %i.icon-flow-parallel
                        =t('scores.info.equalities')
                        %i.icon-arrow-down-triangle
                      .dropdown.dropdown-tip{id: "dropdown_eq_3_#{discussion.id}"}
                        %ul{ class: 'dropdown-menu' }
                %td.center
                  = [l(discussion.start_date.to_date), l(discussion.end_date.to_date)].join(' - ')   
                %td.center{class: "assignment_#{discussion.situation}"}= t("scores.situation.#{discussion.situation}")
                %td.center= discussion.count
                %td.center= link_to content_tag(:i, nil, class: 'icon-text'), user_discussion_posts_path(discussion.academic_tool_id, @user.id), class: 'btn to_evaluate_post', :'data-tooltip'=> t(:discussions_participation, scope: [:scores, :info]), onkeydown: 'click_on_keypress(event, this);'
                
      - else
        .block_content.block_content_text= t(:itens_not_found)

= javascript_include_tag 'tablesorter', 'tooltip', 'scores'

:javascript

  $(function(){
    $("a.to_evaluate_post").call_fancybox();
  });      