.block_wrapper_exam
  .block_title
    %h2= t(:exam, :scope => [:scores, :info])
  .block_content
    #tabs
      %ul
        %li.active 
          = link_to t(:evaluative, scope: [:scores, :info]), "#evaluative"
        %li 
          = link_to t(:frequency, scope: [:scores, :info]), "#frequency"
        %li 
          = link_to t(:not_evaluative, scope: [:scores, :info]), "#notevaluative"

      #evaluative      
        - unless @exams_evaluative.empty?
          - is_user = (@user.id == current_user.id)
          %table.tb_list.list_exams
            %thead
              %tr.lines
                %th{style: "width: 30%;"}= t(:exam, :scope => [:scores, :info])
                %th.center.date{style: "width: 30%;"}= t(:date_range, :scope => [:scores, :info])
                %th.center{style: "width: 20%;"}= t(:situation, :scope => [:scores, :info])
                %th.center{style: "width: 20%;"}= t(:grade, :scope => [:scores, :info])
            %tbody
              - @exams_evaluative.each do |exam|
                - info = exam.info(@user.id, @allocation_tag_id)
                - link = open_exam_path(exam, allocation_tag_id: @allocation_tag_id, situation: info[:situation])
                - pre  = pre_exam_path(exam, allocation_tag_id: @allocation_tag_id, situation: info[:situation])
                %tr.lines
                  %td{align: "left"}
                    - if !['to_answer', 'not_finished', 'retake'].include?(info[:situation])
                      .title= exam.name
                      - if exam.ended? || info[:situation] == 'corrected'
                        = link_to I18n.t(:result, :scope => [:exams, :index]), result_user_exam_path(exam, user_id: @user.id), class: 'link_content', class: 'exam-result'
                        - if is_user && info[:situation] == 'corrected'
                          |
                          = link_to I18n.t(:mirror_results, :scope => [:exams, :index]), link, class: 'open_exam', id: 'open-result'
                    - elsif is_user
                      = link_to exam.name, pre, :'data-tooltip' => exam.name, class: 'link_content link_pre_exam', id: 'open-exam'
                    - else
                      .title= exam.name
                  %td.center
                    %div= [l(exam.start_date.to_date), l(exam.end_date.to_date)].join(' - ')
                    %div= [(exam.start_hour), (exam.end_hour)].compact.join(' - ')
                  %td.center.situation
                    %div{class: "#{info[:situation]}"}= I18n.t(info[:situation], :scope => [:exams, :situation])
                  %td.center.grade
                    - if info[:grade].blank? && exam.ended? && !['to_answer', 'not_finished', 'retake', 'not_answered'].include?(info[:situation])
                      - bt_correction = link_to_function (content_tag(:i, nil, class: 'icon-exam')), 'calcule_grade_user_exam(this)', :"data-tooltip" => t('exams.index.calculate'), :'data-url' => calcule_grade_user_exam_path(exam, user_id: @user.id), class: 'ico-e'
                    %span.activity_grade= info[:grade] || bt_correction || "-"
        - else
          .block_content.block_content_text= t(:itens_not_found)
          
      #frequency
        - unless @exams_frequency.empty?
          - is_user = (@user.id == current_user.id)
          %table.tb_list.list_exams
            %thead
              %tr.lines
                %th{align: "left"}= t(:exam, :scope => [:scores, :info])
                %th.center.date{style: "width: 40%;"}= t(:date_range, :scope => [:scores, :info])
                %th.center{style: "width: 20%;"}= t(:situation, :scope => [:scores, :info])
                %th.center{style: "width: 20%;"}= t(:frequency, :scope => [:scores, :info])
            %tbody
              - @exams_frequency.each do |exam|
                - info = exam.info(@user.id, @allocation_tag_id)
                - link = open_exam_path(exam, allocation_tag_id: @allocation_tag_id, situation: info[:situation])
                - pre  = pre_exam_path(exam, allocation_tag_id: @allocation_tag_id, situation: info[:situation])
                %tr.lines
                  %td{align: "left"}
                    - if !['to_answer', 'not_finished', 'retake'].include?(info[:situation])
                      .title= exam.name
                      - if exam.ended? || info[:situation] == 'corrected'
                        = link_to I18n.t(:result, :scope => [:exams, :index]), result_user_exam_path(exam, user_id: @user.id), class: 'link_content', class: 'exam-result'
                        - if is_user && info[:situation] == 'corrected'
                          |
                          = link_to I18n.t(:mirror_results, :scope => [:exams, :index]), link, class: 'open_exam', id: 'open-result'
                    - elsif is_user
                      = link_to exam.name, pre, :'data-tooltip' => exam.name, class: 'link_content link_pre_exam', id: 'open-exam'
                    - else
                      .title= exam.name
                  %td.center
                    %div= [l(exam.start_date.to_date), l(exam.end_date.to_date)].join(' - ')
                    %div= [(exam.start_hour), (exam.end_hour)].compact.join(' - ')
                  %td.center.situation
                    %div{class: "#{info[:situation]}"}= I18n.t(info[:situation], :scope => [:exams, :situation])
                  %td.center.grade
                    - if info[:grade].blank? && exam.ended? && !['to_answer', 'not_finished', 'retake', 'not_answered'].include?(info[:situation])
                      - bt_correction = link_to_function (content_tag(:i, nil, class: 'icon-exam')), 'calcule_grade_user_exam(this)', :"data-tooltip" => t('exams.index.calculate'), :'data-url' => calcule_grade_user_exam_path(exam, user_id: @user.id), class: 'ico-e'
                    %span.activity_grade= info[:grade] || bt_correction || "-"
        - else
          .block_content.block_content_text= t(:itens_not_found)
      
      #notevaluative 
        - unless @exams_not_evaluative.empty?
          - is_user = (@user.id == current_user.id)
          %table.tb_list.list_exams
            %thead
              %tr.lines
                %th{align: "left"}= t(:exam, :scope => [:scores, :info])
                %th.center.date{style: "width: 40%;"}= t(:date_range, :scope => [:scores, :info])
                %th.center{style: "width: 20%;"}= t(:situation, :scope => [:scores, :info])
                %th.center{style: "width: 20%;"}= t(:grade, :scope => [:scores, :info])
            %tbody
              - @exams_not_evaluative.each do |exam|
                - info = exam.info(@user.id, @allocation_tag_id)
                - link = open_exam_path(exam, allocation_tag_id: @allocation_tag_id, situation: info[:situation])
                - pre  = pre_exam_path(exam, allocation_tag_id: @allocation_tag_id, situation: info[:situation])
                %tr.lines
                  %td{align: "left"}
                    - if !['to_answer', 'not_finished', 'retake'].include?(info[:situation])
                      .title= exam.name
                      - if exam.ended? || info[:situation] == 'corrected'
                        = link_to I18n.t(:result, :scope => [:exams, :index]), result_user_exam_path(exam, user_id: @user.id), class: 'link_content', class: 'exam-result'
                        - if is_user && info[:situation] == 'corrected'
                          |
                          = link_to I18n.t(:mirror_results, :scope => [:exams, :index]), link, class: 'open_exam', id: 'open-result'
                    - elsif is_user
                      = link_to exam.name, pre, :'data-tooltip' => exam.name, class: 'link_content link_pre_exam', id: 'open-exam'
                    - else
                      .title= exam.name
                  %td.center
                    %div= [l(exam.start_date.to_date), l(exam.end_date.to_date)].join(' - ')
                    %div= [(exam.start_hour), (exam.end_hour)].compact.join(' - ')
                  %td.center.situation
                    %div{class: "#{info[:situation]}"}= I18n.t(info[:situation], :scope => [:exams, :situation])
                  %td.center.grade
                    - if info[:grade].blank? && exam.ended? && !['to_answer', 'not_finished', 'retake', 'not_answered'].include?(info[:situation])
                      - bt_correction = link_to_function (content_tag(:i, nil, class: 'icon-exam')), 'calcule_grade_user_exam(this)', :"data-tooltip" => t('exams.index.calculate'), :'data-url' => calcule_grade_user_exam_path(exam, user_id: @user.id), class: 'ico-e'
                    %span.activity_grade= info[:grade] || bt_correction || "-"
        - else
          .block_content.block_content_text= t(:itens_not_found)   

:javascript

  $(function(){
    $("#tabs").tabs();

    $(".link_pre_exam, .open_exam").call_fancybox({
      minWidth: '50%',
      minheigth: '50%',
      closeBtn : true,
      height: 'auto',
      maxHeight: '70%'
    });

    $(".exam-result").call_fancybox({
      minWidth: '50%',
      minHeight: '50%',
      height: 'auto',
      closeBtn : true
    });

  }); 