.block_wrapper.preview_webconferences
  .title-warning= t('.warning')
  - unless @webconferences.blank?
    .block_title
      %h2
        %i.icon-video-conference
        = t(:webconferences, scope: [:webconferences, :list])
    .block_content_toolbar
      .block_toolbar_left
        = label_tag :search, t('.search'), class: 'title'
        = text_field_tag :search, nil, :'data-column' => 'all', type: :search, class: 'search', placeholder: t('.placeholder'), size: 50
      .block_toolbar_right
        %a.btn.delete_record_btn{ href: nil, :'data-dropdown' => "#trash_dropdown", alt: t('.delete_record') }
          = content_tag(:i, nil, class:'icon-trash')
          %i.icon-arrow-down-triangle
        #trash_dropdown.dropdown.dropdown-tip
          %ul.dropdown-menu
            %li
              %a.delete_record{ href: nil, :'data-link-remove' => remove_record_webconference_path(':id') }= t('.delete_record')

    %table.webconferences.tb_list
      %thead
        %tr.lines
          %th.no_sort= check_box_tag :all_webconferences, false, false, :'data-children-names' => 'ckb_webconference', class: 'all_webconferences'
          %th.default_width= t(:name, scope: [:webconferences, :list])
          %th.bigger_width= t('.location')
          %th.medium_width= t(:moderator, scope: [:webconferences, :list])
          %th.default_width= t(:availability, scope: [:webconferences, :list])
          %th.smaller_width= t(:duration, scope: [:webconferences, :list])
          %th.smaller_width= t(:status, scope: [:webconferences, :list])
          %th.invisible
          %th.invisible
          %th.smaller_width= t('webconferences.index.user_online')
          %th.smaller_width.no_sort= t('webconferences.index.recording')
          - if @can_see_access
            %th.smaller_width.no_sort= t('webconferences.index.access')
      %tbody
        - @webconferences.each do |webconference|
          - status = webconference.status(webconference.at_id)
          %tr.lines
            %td{ style: 'text-align:center;' }= check_box_tag :ckb_webconference, webconference.ac_id, false, { class: 'ckb_webconference' }
            %td= webconference.link_to_join(current_user, webconference.at_id)
            %td
              = webconference.shared_between_groups ? webconference.offer_info : AllocationTag.find(webconference.at_id).info
              - groups_codes = webconference.groups_codes
              - unless groups_codes.blank? || !webconference.shared_between_groups
                = raw t('.shared_with', link: link_to(groups_codes.count.to_s, '#', :'data-dropdown' => "#groups_codes_#{webconference.id}"))
                .dropdown.dropdown-tip{ id: "groups_codes_#{webconference.id}" }
                  %ul.dropdown-menu
                    - groups_codes.each do |code|
                      %li= code
            %td{ :'data-tooltip' => webconference.user_name }= raw truncate(webconference.user_name, length: 20)
            %td= l(webconference.initial_time, format: :at_date)
            %td= [webconference.duration.to_s, t(:min, scope: [:webconferences, :list])].join(' ')
            %td.status_webconference= (@online ? status : t(:unavailable, scope: [:webconferences, :list]))
            %td.invisible= webconference.location
            %td.invisible= webconference.user_name
            %td.center= webconference.meeting_info(current_user, webconference.at_id, @meetings)
            %td.center{ class: "#{status == t('webconferences.list.record_available') ? '' : 'disabled'}", :'data-tooltip' => t('webconferences.list.watch')}= link_to content_tag(:i, nil, class: 'icon-play btn'), get_record_webconference_path(webconference.id, at_id: webconference.at_id), class: 'record'
            - if @can_see_access
              %td{ :'data-url' => list_access_webconference_path(webconference.id, at_id: webconference.at_id) }= link_to_function content_tag(:i, nil, class: 'icon-users btn'), 'list_access(this)'
            
    .message_div_navigation
      = will_paginate @webconferences
      
  - else
    .block_content.block_content_text= t(:no_data, scope: [:webconferences, :list])

= javascript_include_tag 'webconferences', 'tooltip'

:javascript
  $(function(){
    $('.record').call_fancybox();
  });
