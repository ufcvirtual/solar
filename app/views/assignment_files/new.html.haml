#file_size.alert.invisible
  %span.message_file_size{ tabindex: 0 }
  %span.close
    %a{href: "#void", onclick: "hide_element(event)", onkeydown: "hide_element(event)", :'aria-label' => t('flash_message.close')}
      %i.icon-cross{ :'aria-hidden' => "true" }
%h1#lightBoxDialogTitle= t(".title")
.block_content{style: "padding: 5px;"}
  = form_for @assignment_file do |f|
    = f.hidden_field :academic_allocation_user_id, value: @assignment_file.academic_allocation_user_id
    = f.file_field :attachment, id: "focu", :'aria-label' => t(:send_file_to_upload)
    .block_content_gray{style: "padding: 5px;"}
      %p.file
      %p=raw t('.send_file_obs')
      %p=raw t(:send_file_text)
    .right_buttons
      = button_tag t(:cancel), :type => 'button', :onclick => "jQuery.fancybox.close()", class: 'btn btn_caution', id: 'btn_cancel_post'
      = button_tag t(:save), class: "btn btn_main save_file", type: :button

:javascript
  $(document).on("keydown", function() {
    var keynum = event.which || event.keyCode;
    if(keynum == 27){
      $.fancybox.close();
    }
  });

  $(function(){
    $(".save_file").click(function(){
      $('form#new_assignment_file').serialize_and_submit({
        files: true,
        prepend_to_list: $(".student_files tbody"),
        outer: 'fancybox-outer',
        error_message: '',
        complement_success: function(){
          $('#tb_lf').show();
          $.fancybox.close();
          flash_message("#{t('assignment_files.success.uploaded')}", "notice");
          $(".assignment_to_be_sent").html("#{t(:sent)}").css("color","#2900C2");
          update_tables_with_no_data();
          focus_element_time('#flash_message_span');
        }
      });
    });

    $("#focu").on("change", function(){
      var file_name_path = $(this).val();
      var file_name = file_name_path.substr( (file_name_path.lastIndexOf('\\')+1) );

      if(this.files[0] != undefined ) {
        var file_size = this.files[0].size;

        if(file_size > 26000000) { // Verifica se o arquivo tem tamanho maior 26 MB
          $('#file_size').removeClass('invisible');
          $('#file_size').show();
          $('.message_file_size').text("#{t('assignment_files.new.attachment_file_size_too_big')}");
          $('.save_file').attr('disabled', true);
          focus_element('.message_file_size');
        } else {
          $('#file_size').addClass('invisible');
          $('.save_file').attr('disabled', false);
          $('#file_size').hide();
          focus_element_time('.file');
        }

        var file_size_extension = new Array('Bytes', 'KB', 'MB', 'GB');

        i = 0;
        while(file_size >= 1000) {
          file_size /= 1000;
          i++;
        }

        var file_size_human_readable = (Math.round(file_size*100)/100) + " " + file_size_extension[i];

        $(".file").html( "#{I18n.t(:send_file_name)}: " + file_name + "<br>" + "#{I18n.t(:send_file_size)}: " + file_size_human_readable );
      }
    });
  });

  function hide_element(event) {
    event.preventDefault();
    $('#file_size').hide();
    $('#focu').focus();
  }
