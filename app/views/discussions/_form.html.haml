.discussion_form
  = simple_form_for(@discussion, html: {id: "discussion_form"}) do |f|
    %h1#lightBoxDialogTitle= t(@discussion.persisted? ? ".edit" : ".new")
    %span.form_requirement= t(:required_fields)

    .form-inputs.block_content
      = hidden_field_tag :allocation_tags_ids, @allocation_tags_ids

      = f.input :name
      = f.input :description

      = f.fields_for :schedule, defaults: {required: true} do |s|
        .schedule_dates
          .left= s.input :start_date, as: :string, input_html: {id: 'from-date', value: l(@discussion.schedule.start_date.try(:to_date) || Date.today, format: :datepicker)}
          .right_form= s.input :end_date, as: :string, input_html: {id: 'until-date', value: l(@discussion.schedule.end_date.try(:to_date) || Date.today, format: :datepicker)}

      .input.files
        = f.label t(".files")
        %i.icon-paperclip.new_file
      
      = f.simple_fields_for :enunciation_files do |files|
        .file_input
          = files.input :_destroy, as: :hidden, input_html: {value: 0, class: "destroy_input_file", :"data-file-id" => files.object.id}
          = files.input :attachment, label: false, input_html: {id: "fileupload"}
      
      .input.list_files_to_send
        - @discussion.enunciation_files.each do |ef|
          - if ef.persisted?
            .input.files
              %label
              %span#file{:"data-file-id" => ef.id}
                = ef.attachment_file_name
                %i.icon-cross-square.warning.remove_file
        - if @files_errors
          %span.field_with_errors.error= @files_errors


      = render "groups/codes"

      .form-actions.right_buttons
        = button_to_function t(".cancel"), "jQuery.fancybox.close()", class: "btn btn_default btn_lightbox", type: "button", alt: t(".cancel")
        = button_to_function t(".save"), "save_discussion()" , class: "btn btn_main btn_lightbox", alt: t(".save"), type: "button"

= javascript_include_tag "edition_discussions"

:javascript

  $("#from-date, #until-date").mask("#{I18n.t('date.formats.mask')}");

  var start_date = "#{escape_once(@discussion.schedule.start_date)}";
  var end_date = "#{escape_once(@discussion.schedule.end_date)}";
  var div_to_replace = ("#{escape_once(params[:calendar])}" == "" ? $(".list_discussions") : $(".calendar_schedules"));
