- path = (@not_offer_area ? open_lesson_path(lesson.id, allocation_tags_ids: @allocation_tags_ids, offer_id: @offer.id) : open_lesson_path(lesson.id))
- start_date = lesson.schedule.start_date
- end_date = lesson.schedule.end_date
%td
  - if lesson.closed?
    = (@not_offer_area ? (link_to_function lesson.name, 'open_lesson(this)', class: 'link_content lesson', :'data-fancybox-type' => 'iframe', :'data-url' => path) : lesson.name)
    = "(#{t(:lesson_closed_short)})"
  - else
    - unless lesson.address.blank?
      = link_to_function lesson.name, 'open_lesson(this)', class: 'link_content lesson', :'data-fancybox-type' => 'iframe', :'data-url' => path

      - if lesson.is_draft?
        .test_lesson= "(#{t(:lesson_test)})"
      - if lesson.will_open?
        .test_lesson= "(#{t(:lesson_will_open)})"
    - else
      = lesson.name
      .test_lesson= "(#{ (lesson.is_file? ? t(:lesson_without_initial_file) : t(:lesson_without_url)) })"

%td{ width: '30%' }
  = "#{t(:since)}" if (end_date.nil?)
  = [l(start_date, format: :normal), (end_date.nil? ? t(:no_end_date) : l(end_date, format: :normal))].join(' - ')

- notes    = current_user.notes(lesson.id)
- no_notes = notes.blank?
%td{ style: 'width: 10%; text-align: center' }
  = content_tag(:a, class: "notes fancybox.ajax", href: '#', :'data-link' => lesson_notes_path(lesson.id), :'data-tooltip' => no_notes ? t('.no_note') : t('.notes'), onclick: 'javascript:open_lesson_notes(this)') do 
    %i.icon-book2
    - unless no_notes
      %span.count_icon= notes.count

- if @responsible
  %td{ width: '12%' }
    - status = [Lesson_Test, Lesson_Approved].delete_if { |v| v == lesson.status }
    = link_to (image_tag "#{lesson.is_draft? ? 'rejected' : 'released'}.png"), responsible_change_status_lesson_path(id: lesson.id, status: status, allocation_tags_ids: @allocation_tags_ids), remote: true, method: :put, class: 'change_lesson_status', :'data-tooltip' => (lesson.is_draft? ? t('lessons.index.draft') :  t('lessons.index.released')), :'data-module-id' => lesson.lesson_module_id

:css
  .list_lessons a.notes{
    text-decoration: none;
  }

:javascript
  function open_lesson(obj){
    var url = $(obj).data('url');
    $(obj).nice_open_lesson({ href: url });
  }

  function open_lesson_notes(obj){
    var url = $(obj).data('link');
    $(obj).call_fancybox({ href: url, open: true });
  }

